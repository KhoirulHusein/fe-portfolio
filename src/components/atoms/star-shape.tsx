"use client";

import { forwardRef, useId } from "react";
import { cn } from "@/lib/utils";

export type StarShapeVariant = 
  | "four-point" 
  | "cross-star" 
  | "gooey-star" 
  | "pinwheel" 
  | "soft-star" 
  | "clover";

interface StarShapeProps {
  variant: StarShapeVariant;
  color?: "primary" | "secondary" | "accent";
  size?: number;
  className?: string;
  style?: React.CSSProperties;
}

// Clip path definitions for each star variant
const clipPaths: Record<StarShapeVariant, { id: string; path: string }> = {
  "four-point": {
    id: "star-four-point",
    path: "M1 0.5C0.867392 0.5 0.740215 0.447322 0.646447 0.353553C0.552678 0.259785 0.5 0.132608 0.5 0C0.5 0.132608 0.447322 0.259785 0.353553 0.353553C0.259785 0.447322 0.132608 0.5 0 0.5C0.132608 0.5 0.259785 0.552678 0.353553 0.646447C0.447322 0.740215 0.5 0.867392 0.5 1C0.5 0.867392 0.552678 0.740215 0.646447 0.646447C0.740215 0.552678 0.867392 0.5 1 0.5Z",
  },
  "cross-star": {
    id: "star-cross",
    path: "M0.939334 0.353525C0.920103 0.334285 0.897270 0.319022 0.872140 0.308609C0.847010 0.298196 0.820075 0.292837 0.792873 0.292837C0.765671 0.292837 0.738736 0.298196 0.713606 0.308609C0.688476 0.319022 0.665643 0.334285 0.646412 0.353525C0.675366 0.324557 0.695081 0.287654 0.703065 0.247482C0.711049 0.207309 0.706943 0.165671 0.691267 0.127832C0.675591 0.089993 0.649048 0.057652 0.614995 0.034898C0.580941 0.012145 0.540906 0.000000 0.499952 0.000000C0.458997 0.000000 0.418962 0.012145 0.384909 0.034898C0.350855 0.057652 0.324312 0.089993 0.308636 0.127832C0.292960 0.165671 0.288854 0.207309 0.296838 0.247482C0.304822 0.287654 0.324537 0.324557 0.353491 0.353525C0.324526 0.324569 0.287627 0.304852 0.247458 0.296867C0.207289 0.288882 0.165655 0.292988 0.127820 0.308666C0.089984 0.324344 0.057646 0.350889 0.034895 0.384946C0.012143 0.419003 0.000000 0.459042 0.000000 0.500000C0.000000 0.540958 0.012143 0.580997 0.034895 0.615054C0.057646 0.649111 0.089984 0.675656 0.127820 0.691334C0.165655 0.707012 0.207289 0.711118 0.247458 0.703133C0.287627 0.695148 0.324526 0.675431 0.353491 0.646475C0.324537 0.675442 0.304822 0.712345 0.296838 0.752518C0.288854 0.792691 0.292960 0.834329 0.308636 0.872168C0.324312 0.910007 0.350855 0.942348 0.384909 0.965102C0.418962 0.987855 0.458997 1.000000 0.499952 1.000000C0.540906 1.000000 0.580941 0.987855 0.614995 0.965102C0.649048 0.942348 0.675591 0.910007 0.691267 0.872168C0.706943 0.834329 0.711049 0.792691 0.703065 0.752518C0.695081 0.712345 0.675366 0.675442 0.646412 0.646475C0.685256 0.685322 0.737940 0.707147 0.792873 0.707147C0.847807 0.707147 0.900490 0.685322 0.939334 0.646475C0.978178 0.607627 1.000000 0.554939 1.000000 0.500000C1.000000 0.445061 0.978178 0.392373 0.939334 0.353525L0.830056 0.329705L0.646412 0.353525Z",
  },
  "gooey-star": {
    id: "star-gooey",
    path: "M0.475097 0.0206081C0.480612 -0.00686926 0.519388 -0.00686941 0.524903 0.0206079L0.571269 0.251605C0.575051 0.270448 0.597161 0.278588 0.61201 0.266604L0.793792 0.119895C0.815436 0.102427 0.845153 0.127617 0.83198 0.152266L0.721096 0.359768C0.712075 0.37665 0.723822 0.397229 0.742771 0.397739L0.975238 0.403995C1.00289 0.404739 1.00963 0.443354 0.983905 0.453651L0.767467 0.540292C0.74985 0.547345 0.745772 0.570735 0.75994 0.58347L0.93413 0.740035C0.954822 0.758634 0.935419 0.792584 0.909186 0.783681L0.688795 0.708892C0.670805 0.702787 0.652793 0.718074 0.655584 0.737078L0.689853 0.970393C0.693926 0.998124 0.657484 1.01152 0.643038 0.987606L0.521679 0.786683C0.511768 0.770275 0.488232 0.770275 0.478321 0.786683L0.356962 0.987606C0.342516 1.01152 0.306074 0.998123 0.310147 0.970393L0.344416 0.737078C0.347207 0.718074 0.329195 0.702787 0.311205 0.708892L0.0908143 0.783681C0.0645805 0.792584 0.0451779 0.758634 0.0658702 0.740035L0.24006 0.58347C0.254228 0.570735 0.25015 0.547345 0.232533 0.540292L0.016095 0.453651C-0.00962926 0.443354 -0.00288931 0.404739 0.0247622 0.403995L0.257229 0.397739C0.276178 0.397229 0.287925 0.37665 0.278904 0.359768L0.16802 0.152266C0.154848 0.127617 0.184564 0.102427 0.206208 0.119895L0.38799 0.266604C0.402839 0.278588 0.424949 0.270448 0.428731 0.251605L0.475097 0.0206081Z",
  },
  "pinwheel": {
    id: "star-pinwheel",
    path: "M0.0669973 0.0638959L0.0639233 0.0672249C0.0359803 0.0951588 0.0161483 0.130152 0.00654426 0.168471C-0.00306075 0.20679 -0.00207675 0.246996 0.00939026 0.284799C0.0208573 0.322602 0.0423773 0.356585 0.0716533 0.38312C0.100929 0.409655 0.136863 0.427748 0.175621 0.435467L0.500214 0.499999L0.435142 0.175547C0.42736 0.136907 0.409251 0.101096 0.382741 0.0719188C0.35623 0.0427409 0.322307 0.0212869 0.284575 0.00983595C0.246844 -0.00161503 0.206714 -0.00263503 0.168449 0.00688295C0.130185 0.0164019 0.0949583 0.0361039 0.0669973 0.0638959L0.500214 0.499999L0.0639233 0.933029L0.0669973 0.936102C0.0949433 0.964034 0.129952 0.983857 0.168287 0.993457C0.206622 1.00306 0.246845 1.00208 0.284666 0.990612C0.322485 0.97915 0.356482 0.957639 0.383029 0.928376C0.409576 0.899112 0.427676 0.863193 0.435398 0.824452L0.500214 0.499999L0.175621 0.564787C0.136863 0.572506 0.100929 0.590599 0.0716533 0.617134C0.0423773 0.643669 0.0208573 0.677652 0.00939026 0.715455C-0.00207675 0.753259 -0.00306075 0.793465 0.00654426 0.831784C0.0161483 0.870102 0.0359803 0.905095 0.0639233 0.933029L0.936504 0.0669689L0.93343 0.0638959C0.905484 0.0359639 0.870475 0.0161409 0.83214 0.00654095C0.793805 -0.00305903 0.753582 -0.00207603 0.715762 0.00938595C0.677942 0.0208479 0.643945 0.0423589 0.617399 0.0716218C0.590852 0.100886 0.572752 0.136805 0.56503 0.175547L0.500214 0.499999L0.824806 0.434955C0.863462 0.427176 0.899288 0.409075 0.928478 0.382576C0.957667 0.356076 0.97913 0.322167 0.990586 0.284453C1.00204 0.246739 1.00306 0.206626 0.993541 0.168378C0.984018 0.130129 0.964308 0.0949178 0.936504 0.0669689L0.500214 0.499999L0.565286 0.824452C0.573068 0.863091 0.591177 0.898902 0.617687 0.928079C0.644198 0.957257 0.678121 0.97871 0.715852 0.990162C0.753583 1.00161 0.793713 1.00264 0.831977 0.993115C0.870242 0.983596 0.905213 0.963894 0.933173 0.936102L0.936248 0.933029C0.964121 0.905088 0.983892 0.870114 0.993455 0.831831C1.00302 0.793547 1.00202 0.753388 0.990555 0.715628C0.979093 0.677869 0.957602 0.643924 0.928369 0.617406C0.899136 0.590889 0.863513 0.572792 0.824806 0.565043L0.500214 0.499999L0.0669973 0.0638959Z",
  },
  "soft-star": {
    id: "star-soft",
    path: "M0.911218 0.329658C0.917139 0.29671 0.914994 0.262818 0.904967 0.23088C0.894939 0.198941 0.877327 0.169906 0.853635 0.146256C0.829944 0.122605 0.800878 0.105043 0.768923 0.0950708C0.736967 0.0850983 0.703072 0.083012 0.670134 0.0889901C0.651042 0.0615242 0.625587 0.0390856 0.595943 0.0235895C0.566299 0.00809344 0.533346 0 0.499896 0C0.466446 0 0.433493 0.00809344 0.403849 0.0235895C0.374204 0.0390856 0.34875 0.0615242 0.329658 0.0889901C0.29675 0.0830893 0.262904 0.0852337 0.231005 0.0952406C0.199106 0.105248 0.1701 0.12282 0.14646 0.14646C0.12282 0.1701 0.105248 0.199106 0.0952406 0.231005C0.0852337 0.262904 0.0830893 0.29675 0.0889901 0.329658C0.0615242 0.34875 0.0390856 0.374204 0.0235895 0.403849C0.00809344 0.433493 0 0.466446 0 0.499896C0 0.533346 0.00809344 0.566299 0.0235895 0.595943C0.0390856 0.625587 0.0615242 0.651042 0.0889901 0.670134C0.0830405 0.703077 0.0851562 0.73697 0.0951563 0.768917C0.105156 0.800864 0.122744 0.829915 0.146414 0.853586C0.170085 0.877256 0.199136 0.894844 0.231083 0.904844C0.26303 0.914844 0.296923 0.916959 0.329866 0.91101C0.348958 0.938476 0.374413 0.960914 0.404057 0.97641C0.433701 0.991907 0.466654 1 0.500104 1C0.533554 1 0.566507 0.991907 0.596151 0.97641C0.625796 0.960914 0.65125 0.938476 0.670343 0.91101C0.70327 0.916921 0.737139 0.914776 0.769057 0.904759C0.800976 0.894741 0.829997 0.877149 0.853642 0.853483C0.877287 0.829818 0.894854 0.800782 0.904844 0.768854C0.914834 0.736927 0.916949 0.703056 0.91101 0.670134C0.938476 0.651042 0.960914 0.625587 0.97641 0.595943C0.991907 0.566299 1 0.533346 1 0.499896C1 0.466446 0.991907 0.433493 0.97641 0.403849C0.960914 0.374204 0.938476 0.34875 0.91101 0.329658H0.911218Z",
  },
  "clover": {
    id: "star-clover",
    path: "M0.75 0.5C0.799445 0.5 0.84778 0.485338 0.888892 0.457867C0.930005 0.430397 0.962048 0.391352 0.98097 0.345671C0.999892 0.299989 1.00484 0.249723 0.995196 0.201227C0.98555 0.152732 0.96174 0.108187 0.926777 0.0732234C0.891813 0.0382603 0.847268 0.0144501 0.798772 0.00480379C0.750277 -0.00484251 0.700011 0.000108321 0.654329 0.0190302C0.608648 0.0379521 0.569603 0.0699952 0.542133 0.111108C0.514662 0.15222 0.5 0.200555 0.5 0.25C0.5 0.200555 0.485338 0.15222 0.457867 0.111108C0.430397 0.0699952 0.391352 0.0379521 0.345671 0.0190302C0.299989 0.000108321 0.249723 -0.00484251 0.201227 0.00480379C0.152732 0.0144501 0.108187 0.0382603 0.0732234 0.0732234C0.0382603 0.108187 0.0144501 0.152732 0.00480379 0.201227C-0.00484251 0.249723 0.000108321 0.299989 0.0190302 0.345671C0.0379521 0.391352 0.0699952 0.430397 0.111108 0.457867C0.15222 0.485338 0.200555 0.5 0.25 0.5C0.200555 0.5 0.15222 0.514662 0.111108 0.542133C0.0699952 0.569603 0.0379521 0.608648 0.0190302 0.654329C0.000108321 0.700011 -0.00484251 0.750277 0.00480379 0.798772C0.0144501 0.847268 0.0382603 0.891813 0.0732234 0.926777C0.108187 0.96174 0.152732 0.98555 0.201227 0.995196C0.249723 1.00484 0.299989 0.999892 0.345671 0.98097C0.391352 0.962048 0.430397 0.930005 0.457867 0.888892C0.485338 0.84778 0.5 0.799445 0.5 0.75C0.5 0.799445 0.514662 0.84778 0.542133 0.888892C0.569603 0.930005 0.608648 0.962048 0.654329 0.98097C0.700011 0.999892 0.750277 1.00484 0.798772 0.995196C0.847268 0.98555 0.891813 0.96174 0.926777 0.926777C0.96174 0.891813 0.98555 0.847268 0.995196 0.798772C1.00484 0.750277 0.999892 0.700011 0.98097 0.654329C0.962048 0.608648 0.930005 0.569603 0.888892 0.542133C0.84778 0.514662 0.799445 0.5 0.75 0.5ZM0.5 0.625C0.466848 0.625 0.435054 0.61183 0.411612 0.588388C0.38817 0.564946 0.375 0.533152 0.375 0.5C0.375 0.466848 0.38817 0.435054 0.411612 0.411612C0.435054 0.38817 0.466848 0.375 0.5 0.375C0.533152 0.375 0.564946 0.38817 0.588388 0.411612C0.61183 0.435054 0.625 0.466848 0.625 0.5C0.625 0.533152 0.61183 0.564946 0.588388 0.588388C0.564946 0.61183 0.533152 0.625 0.5 0.625Z",
  },
};

// Color mappings using CSS variables
const colorClasses: Record<string, string> = {
  primary: "bg-primary",
  secondary: "bg-secondary",
  accent: "bg-accent",
};

// Glow gradient mappings for radial backgrounds
const glowGradients: Record<string, string> = {
  primary: "radial-gradient(ellipse at center, rgba(255, 128, 0, 0.5) 0%, rgba(255, 102, 0, 0.3) 40%, transparent 70%)",
  secondary: "radial-gradient(ellipse at center, rgba(0, 102, 255, 0.5) 0%, rgba(0, 102, 255, 0.3) 40%, transparent 70%)",
  accent: "radial-gradient(ellipse at center, rgba(128, 0, 255, 0.5) 0%, rgba(128, 0, 255, 0.3) 40%, transparent 70%)",
};

export const StarShape = forwardRef<HTMLDivElement, StarShapeProps>(
  ({ variant, color = "primary", size = 100, className, style }, ref) => {
    const clipPath = clipPaths[variant];
    const uniqueId = useId();
    const clipPathId = `${clipPath.id}-${uniqueId}`;

    return (
      <>
        {/* Hidden SVG for clip path definition */}
        <svg width="0" height="0" className="absolute" style={{ position: 'absolute' }}>
          <defs>
            <clipPath id={clipPathId} clipPathUnits="objectBoundingBox">
              <path d={clipPath.path} />
            </clipPath>
          </defs>
        </svg>
        <div className="relative" style={{ width: size, height: size }}>
          {/* Glow effect behind the star */}
          <div
            className="absolute inset-0 will-change-transform -z-10"
            style={{
              background: glowGradients[color],
              filter: "blur(20px)",
              opacity: 0.8,
              transform: "scale(1.5)",
            }}
          />
          {/* Star shape */}
          <div
            ref={ref}
            className={cn(
              "relative will-change-transform z-10",
              colorClasses[color],
              className
            )}
            style={{
              width: size,
              height: size,
              clipPath: `url(#${clipPathId})`,
              ...style,
            }}
          />
        </div>
      </>
    );
  }
);

StarShape.displayName = "StarShape";

// Export clip path definitions for SVG usage if needed
export const StarClipPathDefs = () => (
  <svg className="sr-only absolute" aria-hidden="true">
    <defs>
      {Object.entries(clipPaths).map(([key, { id, path }]) => (
        <clipPath key={key} id={id} clipPathUnits="objectBoundingBox">
          <path d={path} fill="black" />
        </clipPath>
      ))}
    </defs>
  </svg>
);
